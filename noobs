
--[[
getgenv().TBSettings = {
    LoadTB = true,
    SilentMode = false, 

    Keybinds = {
        Hold        = Enum.KeyCode.B,
        Bruteforce  = Enum.KeyCode.C,
        Disable     = Enum.KeyCode.B,
        SilentMode  = Enum.KeyCode.P,
    },

    Delays = {
        TBDelay     = nil, 
        TBDelay2    = nil,
        HostDelay   = nil,
        HostDelay2  = nil,
    }
}

--]]

local Settings = getgenv().TBSettings

if Settings.LoadTB then


local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local StarterGui = game:GetService("StarterGui")
local Workspace = game:GetService("Workspace")

local toggled = false
local connection = nil



local player = Players.LocalPlayer
local mouse = player:GetMouse()

local UserInputService = game:GetService("UserInputService")

local StarterGui = game:GetService("StarterGui")
local localPlayer = Players.LocalPlayer

local oldPrint = print
function print(text)
  if Settings.SilentMode then return end
  oldPrint(text)
end

--[[
THESE ARE THE ONLY STUFF YOU SHOULD EDIT UNDER HERE

_G.Settings.SilentMode = false
_G.holdkeybind = Enum.KeyCode.B
_G.bruteforcekeybind = Enum.KeyCode.C
_G.disablekeybind = Enum.KeyCode.B
_G.modekeybind = Enum.KeyCode.P -- press p or whatever to switch Settings.SilentMode (toggles Settings.SilentMode on and off)
--]]





local hostshot = false
local bruteforce = false -- we can make true to use a keybind to stop host

local canselecthost = false
local UserInputService = game:GetService("UserInputService")

local hosts = {}
function notify(title, text, time)
  if Settings.SilentMode then return end
  StarterGui:SetCore("SendNotification", {
      Title = title,
      Text = text,
      Duration = time
  })
end



function connect(player3)
    notify("New Host", tostring(player3), 1)
end



local targetting
local targetmode = false

function checkifdead(player4)
  if player.Character.BodyEffects["K.O"].Value == true then -- stop after local player dies
    hostshot = false
    targetmode = false
    return
  end

  --print(player4)
  if Players:FindFirstChild(player4).Character.BodyEffects["K.O"].Value == true then
    -- stop after targetting player dies (knockcheck)
    --print(val.Value, "ahhahahahaha")
    hostshot = false
    targetmode = false -- we reset the lock aswell
  end
end



local lastshot = 0
RunService.RenderStepped:Connect(function()
    --print("host:", host)
    if #hosts > 0 and not hostshot and not disabled then
        for _, host in ipairs(hosts) do
            local plr = Players:FindFirstChild(host)
            --print(plr)
            local val = plr.Character.BodyEffects.GunFiring
            if val.Value == true then
                hostshot = true
                break
            end
        end
        if Settings.Delays.HostDelay and hostshot then
            if Settings.Delays.HostDelay2 then
                task.wait(math.random(Settings.Delays.HostDelay, Settings.Delays.HostDelay2))
            else
                task.wait(Settings.Delays.HostDelay)
            end
        end
    end

    if hostshot then

        if Settings.Delays.TBDelay and hostshot then
            local cooldown = Settings.Delays.TBDelay2 and math.random(Settings.Delays.TBDelay, Settings.Delays.TBDelay2) or Settings.Delays.TBDelay
            if tick() - lastshot < cooldown then
                return
            end
        end        

        local target = mouse.Target
        if target and target.Name == "Hitbox" then
            local parent = target.Parent
            local grandparentName = target.Parent.Parent.Parent and tostring(target.Parent.Parent.Parent)
            if parent and parent.Name == "RootAttachment" and not targetmode or (targetmode and grandparentName == targetting) then
                --print("hi1")
                local tool = player.Character:FindFirstChildOfClass("Tool")
                if tool and tostring(tool) ~= "[Knife]" then
            
                    tool:Activate()
                    lastshot = tick()
                    --print("activatedwotarget")

                    targetting = grandparentName
                    targetmode = true
                end
            end
        end
    end

end)

function isHost(name)
    for _, host in ipairs(hosts) do
        if host == name then
            return true
        end
    end
    return false
end
function removeHost(name)
    for i, host in ipairs(hosts) do
        if host == name then
            table.remove(hosts, i)
            return true
        end
    end
    return false
end

function addHost(name)
    table.insert(hosts, name)
end

local globalupdate
local refreshList

local function createWhitelistTool()
    local tool = Instance.new("Tool")
    tool.Name = "HostWhitelist"
    tool.RequiresHandle = false

    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "roaxe"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = localPlayer:WaitForChild("PlayerGui")
    screenGui.Enabled = false

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 250, 0, 350)
    frame.Position = UDim2.new(0, 20, 0.5, -175)
    frame.BackgroundTransparency = 0.2
    frame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    frame.Parent = screenGui
    local topBar = Instance.new("Frame")
    topBar.Size = UDim2.new(1, -10, 0, 40)
    topBar.Position = UDim2.new(0, 5, 0, 5)
    topBar.BackgroundTransparency = 1
    topBar.Parent = frame

    local uiLayout = Instance.new("UIListLayout")
    uiLayout.FillDirection = Enum.FillDirection.Horizontal
    uiLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    uiLayout.VerticalAlignment = Enum.VerticalAlignment.Center
    uiLayout.SortOrder = Enum.SortOrder.LayoutOrder
    uiLayout.Parent = topBar
    --[[
    local minusBtn = Instance.new("TextButton")
    minusBtn.Text = "-"
    minusBtn.Font = Enum.Font.SourceSansBold
    minusBtn.TextSize = 28
    minusBtn.Size = UDim2.new(0, 40, 0, 30)
    minusBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    minusBtn.TextColor3 = Color3.new(1, 1, 1)
    minusBtn.Parent = topBar
=
    local stompCountBox = Instance.new("TextBox")
    stompCountBox.Text = tostring(stompCount)
    stompCountBox.Font = Enum.Font.SourceSans
    stompCountBox.TextSize = 24
    stompCountBox.Size = UDim2.new(0, 80, 0, 30)
    stompCountBox.ClearTextOnFocus = false
    stompCountBox.TextColor3 = Color3.new(1, 1, 1)
    stompCountBox.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
    stompCountBox.Parent = topBar
    stompCountBox.TextScaled = true
    stompCountBox.TextWrapped = true

    local plusBtn = Instance.new("TextButton")
    plusBtn.Text = "+"
    plusBtn.Font = Enum.Font.SourceSansBold
    plusBtn.TextSize = 28
    plusBtn.Size = UDim2.new(0, 40, 0, 30)
    plusBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
    plusBtn.TextColor3 = Color3.new(1, 1, 1)
    plusBtn.Parent = topBar
        --]]
    local scroll = Instance.new("ScrollingFrame")
    scroll.Size = UDim2.new(1, -10, 1, -55)
    scroll.Position = UDim2.new(0, 5, 0, 45)
    scroll.CanvasSize = UDim2.new(0, 0, 2, 0)
    scroll.ScrollBarThickness = 6
    scroll.BackgroundTransparency = 1
    scroll.Parent = frame

    local listLayout = Instance.new("UIListLayout")
    listLayout.SortOrder = Enum.SortOrder.LayoutOrder
    listLayout.Parent = scroll

    refreshList = function()
        for _, child in pairs(scroll:GetChildren()) do
            if child:IsA("TextButton") or child:IsA("Frame") then
                child:Destroy()
            end
        end
        globalupdate = function()
            for _, player in ipairs(Players:GetPlayers()) do
                if player ~= localPlayer then
                    local button = Instance.new("TextButton")
                    button.Size = UDim2.new(1, -10, 0, 40)
                    button.BackgroundColor3 = isHost(player.Name) and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
                    button.TextColor3 = Color3.new(1, 1, 1)
                    button.AutoButtonColor = false
                    button.Parent = scroll
                    button.Text = ""

                    local avatar = Instance.new("ImageLabel")
                    avatar.Size = UDim2.new(0, 36, 0, 36)
                    avatar.Position = UDim2.new(0, 5, 0, 2)
                    avatar.BackgroundTransparency = 1
                    avatar.Parent = button
                    local success, thumbnail = pcall(function()
                        return Players:GetUserThumbnailAsync(player.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size48x48)
                    end)
                    if success and thumbnail then
                        avatar.Image = thumbnail
                    else
                        avatar.Image = ""
                    end

                    local label = Instance.new("TextLabel")
                    label.Size = UDim2.new(1, -50, 1, 0)
                    label.Position = UDim2.new(0, 46, 0, 0)
                    label.BackgroundTransparency = 1
                    label.TextColor3 = Color3.new(1,1,1)
                    label.TextXAlignment = Enum.TextXAlignment.Left
                    label.Font = Enum.Font.SourceSansBold
                    label.TextSize = 18
                    label.Text = string.format("%s (%s)", player.DisplayName, player.Name)
                    label.Parent = button

                    button.MouseButton1Click:Connect(function()
                        if isHost(player.Name) then
                            removeHost(player.Name)
                            button.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
                        else
                            addHost(player.Name)
                            button.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
                        end
                    end)
                end
            end
        end
        globalupdate()
    end

    refreshList()

    Players.PlayerAdded:Connect(refreshList)
    Players.PlayerRemoving:Connect(refreshList)

    tool.Equipped:Connect(function()
        screenGui.Enabled = true
        --notify("bot", "whitelist a player by making them green with the tool", 5)
        --notify("bot", "increase/decrease the amount of stomps per frame. higher = louder but can also spike your ping if you stay over them for too long", 7)
    end)

    tool.Unequipped:Connect(function()
        screenGui.Enabled = false
    end)
    --[[
    minusBtn.MouseButton1Click:Connect(function()
        local newVal = tonumber(stompCountBox.Text) or stompCount
        newVal = math.max(1, newVal - 1)
        stompCount = newVal
        stompCountBox.Text = tostring(stompCount)
    end)

    plusBtn.MouseButton1Click:Connect(function()
        local newVal = tonumber(stompCountBox.Text) or stompCount
        newVal = math.min(100, newVal + 1)
        stompCount = newVal
        stompCountBox.Text = tostring(stompCount)
    end)

    stompCountBox.FocusLost:Connect(function(enterPressed)
        local val = tonumber(stompCountBox.Text)
        if val == nil or val < 1 then
            stompCountBox.Text = tostring(stompCount)
        else
            stompCount = math.clamp(math.floor(val), 1, 100)
            stompCountBox.Text = tostring(stompCount)
        end
    end)
    --]]

    tool.Parent = localPlayer:WaitForChild("Backpack")
end

localPlayer.CharacterAdded:Connect(function()
    task.wait(2)
    createWhitelistTool()
end)

createWhitelistTool()





UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if gameProcessed then return end

	if input.UserInputType == Enum.UserInputType.MouseButton1 and canselecthost then
		local target = mouse.Target
        local x = target.Parent.Parent.Parent
        if x then
            table.insert(hosts, tostring(x))
            refreshList()
            connect(host)
            return
        end
	end


	if input.KeyCode == Settings.Keybinds.Hold then
		canselecthost = true
        return
	end

    if input.KeyCode == Settings.Keybinds.Hold then
		canselecthost = false
        return
	end

    if input.KeyCode == Settings.Keybinds.Bruteforce then
        hostshot = false
        notify("Reset Host", "we resetted the host doofus", 2)
        return
	end

    if input.KeyCode == Settings.Keybinds.Disable then
        hostshot = false
        disabled = not disabled
        if disabled then
            notify("TB STATUS", "COMPLETELY DISABLED AND HOSTS HAVE BEEN RESET", 2)
            hosts = {}
            refreshList()
        else
            notify("TB STATUS", "enabled - waiting for hostshot", 2)
        end
        return
	end    

	if input.KeyCode == Settings.Keybinds.SilentMode then
    Settings.SilentMode = not Settings.SilentMode
    notify("SILENT MODE STATUS", tostring(Settings.SilentMode), 1)
    return
	end

end)

warn("macrox didnt load")



notify('EXECTUED VERSION PROGAMING', 'I MADE THIS PUSSY', 1)
end


